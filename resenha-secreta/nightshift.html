<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <title>turnoMacabro</title>
        <style>
            body { 
                margin: 0; 
                overflow: hidden; 
                background-color: black; 
                font-family: "Courier New", Courier, monospace;
            }
            .office-layer { z-index: 1; }
            .animatronic-layer { z-index: 2; }
            .cam-layer { z-index: 3; }
            .static-layer { z-index: 4; }
            .map-layer { z-index: 5; }
            .door-indicator { z-index: 90; }
            .ui-layer { z-index: 100; }
            .clickable { cursor: pointer; transition: opacity 0.1s; } 
            .clickable:active { opacity: 0.8; }
            .loading {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: white;
                font-size: 24px;
                z-index: 1000;
            }
        </style>
    </head>
    <body>
        <div id="loading" class="loading">Carregando... 0%</div>
        
        <img src='nightshift/office-open.png' id='office' class="office-layer" width='100%' height='100%' style='position: absolute; top: 0%; left: 0%;'>
        <img src='nightshift/goldenFreddy/office.png' id='goldenOffice' class="animatronic-layer" width='30%' height='60%' style='position: absolute; top: 40%; left: 35%; visibility: hidden;'>
        <img src='nightshift/kitchen.png' id='camera' class="cam-layer" width='100%' height='100%' style='position: absolute; top: 0%; left: 0%; visibility: hidden;'>
        <img src='nightshift/static.gif' id='static' class="static-layer" width='100%' height='100%' style='position: absolute; top: 0%; left: 0%; visibility: hidden; opacity: 0.3;'>
        
        <img src='nightshift/monitor.png' id='monitor' onclick='game.handleMonitorClick()' class="ui-layer clickable" width='44%' height='8%' style='position: absolute; top: 87%; left: 27%;'>
        <img src='nightshift/map.png' id='map' class="map-layer ui-layer" width='30%' height='70%' style='position: absolute; top: 20%; left: 70%; visibility: hidden;'>
        
        <img src='nightshift/leftOff.png' id='leftButtom' onclick='game.leftDoorToggle()' class="ui-layer clickable" width='5%' height='20%' style='position: absolute; top: 40%; left: 0.1%;'>
        <img src='nightshift/doorOpen.png' id='leftDoor' class="door-indicator" width='1.5%' height='3.5%' style='position: absolute; top: 77.3%; left: 80.7%; visibility: hidden;'>
        
        <img src='nightshift/rightOff.png' id='rightButtom' onclick='game.rightDoorToggle()' class="ui-layer clickable" width='5%' height='20%' style='position: absolute; top: 40%; right: 1%;'>
        <img src='nightshift/doorOpen.png' id='rightDoor' class="door-indicator" width='1.5%' height='3.5%' style='position: absolute; top: 77.3%; left: 84.6%; visibility: hidden;'>
        
        <img src='nightshift/camOff.png' id='showStage' onclick='game.camera(0)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 25%; left: 78%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='diningArea' onclick='game.camera(1)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 33%; left: 76%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='backstage' onclick='game.camera(2)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 40%; left: 69%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='pirateCove' onclick='game.camera(3)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 47%; left: 74%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='restrooms' onclick='game.camera(4)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 38%; left: 94%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='kitchen' onclick='game.camera(5)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 61%; left: 94%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='westHall' onclick='game.camera(6)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 68%; left: 78%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='supplyCloset' onclick='game.camera(7)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 64%; left: 72%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='westCorner' onclick='game.camera(8)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 73%; left: 78%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='eastHall' onclick='game.camera(9)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 68%; left: 86%; visibility: hidden;'>
        <img src='nightshift/camOff.png' id='eastCorner' onclick='game.camera(10)' class="cam-button ui-layer clickable" width='4%' height='5%' style='position: absolute; top: 73%; left: 86%; visibility: hidden;'>
        
        <p id='timerTxt' class="ui-layer" style='font-weight: bold; font-size: 150%; color: white; position: absolute; top: 5%; left: 3%'>12:00 AM</p>
        <p id='powerTxt' class="ui-layer" style='font-weight: bold; font-size: 150%; color: white; position: absolute; top: 80%; left: 3%'>POWER LEFT: 100%</p>
        <p id='usageTxt' class="ui-layer" style='font-weight: bold; font-size: 150%; color: white; position: absolute; top: 87%; left: 3%'>USAGE: |</p>
        
        <audio src='nightshift/audios/blip3.wav' id='blip'></audio>
        <audio src='nightshift/audios/CMPTR_Low_Tech_Stat.wav' id='ambienceCamera' loop></audio>
        <audio src='nightshift/audios/Laugh_Giggle_Girl_1.wav' id='goldenLaugh'></audio>
        <audio src='nightshift/audios/Laugh_Giggle_Girl_1d.wav' id='laugh1'></audio>
        <audio src='nightshift/audios/Laugh_Giggle_Girl_2d.wav' id='laugh2'></audio>
        <audio src='nightshift/audios/Laugh_Giggle_Girl_8d.wav' id='laugh3'></audio>
        <audio src='nightshift/audios/music box.wav' id='musicBox'></audio>
        <audio src='nightshift/audios/oui.mp3' id='oui'></audio>
        <audio src='nightshift/audios/OVEN-DRA_1_GEN-HDF18119.wav' id='kitchen1'></audio>
        <audio src='nightshift/audios/OVEN-DRA_2_GEN-HDF18120.wav' id='kitchen2'></audio>
        <audio src='nightshift/audios/powerdown.wav' id='powerDown'></audio>
        <audio src='nightshift/audios/run.wav' id='run'></audio>
        <audio src='nightshift/audios/SFXBible_12478.wav' id='door'></audio>
        <audio src='nightshift/audios/STEREO_CASSETTE__90097701.wav' id='tabletOn'></audio>
        <audio src='nightshift/audios/STEREO_CASSETTE__90097704.wav' id='tabletOff'></audio>
        <audio src='nightshift/audios/walk1.wav' id='walk1'></audio>
        <audio src='nightshift/audios/walk2.wav' id='walk2'></audio>
        <audio src='nightshift/audios/walk3.wav' id='walk3'></audio>
        <audio src='nightshift/audios/walk4.wav' id='walk4'></audio>
        <audio src='nightshift/audios/walk5.wav' id='walk5'></audio>
        <audio src='nightshift/audios/XSCREAM.wav' id='jumpscare'></audio>
        <audio src='nightshift/audios/XSCREAM2.wav' id='goldenJumpscare'></audio>
        
        <audio id="audio" src="03. Pizza Dinner.mp3" loop></audio>
        
        <script>
            const TimerManager = {
                timers: [],
                add(callback, delay) {
                    const id = setTimeout(() => {
                        callback();
                        this.timers = this.timers.filter(t => t !== id);
                    }, delay);
                    this.timers.push(id);
                    return id;
                },
                clearAll() {
                    this.timers.forEach(id => clearTimeout(id));
                    this.timers = [];
                }
            };

            const AudioManager = {
                play(id, restart = true) {
                    const audio = document.getElementById(id);
                    if (!audio) return;
                    if (restart) audio.currentTime = 0;
                    audio.play().catch(e => {
                        if (e.name !== 'NotAllowedError') {
                            console.warn(`Audio ${id} falhou:`, e);
                        }
                    });
                },
                stop(id) {
                    const audio = document.getElementById(id);
                    if (audio) {
                        audio.pause();
                        audio.currentTime = 0;
                    }
                },
                stopAll() {
                    ['ambienceCamera', 'musicBox', 'audio'].forEach(id => this.stop(id));
                }
            };

            const game = {
                state: {
                    isGameOver: false,
                    leftDoor: false,
                    rightDoor: false,
                    tablet: false,
                    timerCounter: 12,
                    powerCounter: 100,
                    usageCounter: 1,
                    currentCam: 0,
                    animatronics: {
                        bonnie: { pos: -1, isMoving: false },
                        chica: { pos: -1, isMoving: false },
                        freddy: { pos: -1, isMoving: false },
                        foxy: { pos: -1, isMoving: false }
                    },
                    golden: { scare: 0, active: false },
                    bearOutage: 0
                },

                getElement(id) {
                    return document.getElementById(id);
                },

                setVisible(id, visible) {
                    const el = this.getElement(id);
                    if (el) el.style.visibility = visible ? 'visible' : 'hidden';
                },

                updateOfficeImage() {
                    const officeImg = this.getElement('office');
                    if (!officeImg) return;
                    let imgPath = 'nightshift/';
                    if (this.state.leftDoor && this.state.rightDoor) {
                        imgPath += 'office-closed.png';
                    } else if (this.state.leftDoor) {
                        imgPath += 'office-left-door.png';
                    } else if (this.state.rightDoor) {
                        imgPath += 'office-right-door.png';
                    } else {
                        imgPath += 'office-open.png';
                    }
                    officeImg.src = imgPath;
                },

                updateUsageDisplay() {
                    const usageTxt = this.getElement('usageTxt');
                    if (!usageTxt) return;
                    const bars = '|'.repeat(Math.min(this.state.usageCounter, 4));
                    usageTxt.innerText = 'USAGE: ' + bars;
                },

                updateUI() {
                    this.updateOfficeImage();
                    this.updateUsageDisplay();
                    const doorsVisible = !this.state.tablet && this.state.bearOutage === 0;
                    const leftBtn = this.getElement('leftButtom');
                    const rightBtn = this.getElement('rightButtom');
                    if (leftBtn) {
                        leftBtn.src = this.state.leftDoor ? 'nightshift/leftOn.png' : 'nightshift/leftOff.png';
                        leftBtn.style.visibility = doorsVisible ? 'visible' : 'hidden';
                    }
                    if (rightBtn) {
                        rightBtn.src = this.state.rightDoor ? 'nightshift/rightOn.png' : 'nightshift/rightOff.png';
                        rightBtn.style.visibility = doorsVisible ? 'visible' : 'hidden';
                    }
                    this.setVisible('monitor', this.state.bearOutage === 0);
                    this.setVisible('leftDoor', this.state.tablet && this.state.leftDoor);
                    this.setVisible('rightDoor', this.state.tablet && this.state.rightDoor);
                },

                leftDoorToggle() {
                    if (this.state.isGameOver || this.state.powerCounter <= 0 || 
                        this.state.bearOutage === 1 || this.state.tablet) return;
                    this.state.leftDoor = !this.state.leftDoor;
                    this.state.usageCounter += this.state.leftDoor ? 1 : -1;
                    AudioManager.play('door');
                    this.updateUI();
                },

                rightDoorToggle() {
                    if (this.state.isGameOver || this.state.powerCounter <= 0 || 
                        this.state.bearOutage === 1 || this.state.tablet) return;
                    this.state.rightDoor = !this.state.rightDoor;
                    this.state.usageCounter += this.state.rightDoor ? 1 : -1;
                    AudioManager.play('door');
                    this.updateUI();
                },

                handleMonitorClick() {
                    if (this.state.isGameOver || this.state.powerCounter <= 0 || this.state.bearOutage === 1) return;
                    this.state.tablet = !this.state.tablet;
                    const visible = this.state.tablet;
                    this.setVisible('camera', visible);
                    this.setVisible('static', visible);
                    this.setVisible('map', visible);
                    this.setVisible('goldenOffice', false);
                    this.state.golden.scare = 0;
                    const camButtons = ['showStage', 'diningArea', 'backstage', 'pirateCove', 
                                       'restrooms', 'kitchen', 'westHall', 'supplyCloset', 
                                       'westCorner', 'eastHall', 'eastCorner'];
                    camButtons.forEach(id => this.setVisible(id, visible));
                    if (this.state.tablet) {
                        AudioManager.play('tabletOn');
                        AudioManager.play('ambienceCamera');
                        this.state.usageCounter++;
                        this.camera(this.state.currentCam);
                    } else {
                        AudioManager.stop('ambienceCamera');
                        AudioManager.play('tabletOff');
                        this.state.usageCounter--;
                        this.goldenJumpscare();
                        this.goldenAI();
                    }
                    this.updateUI();
                },

                camera(camCounter, noBlip = false) {
                    if (!this.state.tablet) return;
                    this.state.currentCam = camCounter;
                    const camImg = this.getElement('camera');
                    if (!camImg) return;
                    if (!noBlip) AudioManager.play('blip');
                    this.goldenAI();
                    const cameraNames = ['showStage', 'diningArea', 'backstage', 'pirateCove', 
                                        'restrooms', 'kitchen', 'westHall', 'supplyCloset', 
                                        'westCorner', 'eastHall', 'eastCorner'];
                    camImg.src = 'nightshift/' + cameraNames[camCounter] + '.png';
                    if (camCounter === 5) {
                        AudioManager.play('kitchen1');
                        AudioManager.play('kitchen2');
                    }
                    const bonnie = this.state.animatronics.bonnie.pos;
                    if (camCounter === 0 && bonnie >= 1) camImg.src = 'nightshift/bonnie/showStage.png';
                    else if (camCounter === 1 && bonnie === 1) camImg.src = 'nightshift/bonnie/diningArea.png';
                    else if (camCounter === 2 && bonnie === 2) camImg.src = 'nightshift/bonnie/backstage.png';
                    else if (camCounter === 6 && bonnie === 3) camImg.src = 'nightshift/bonnie/westHall.png';
                    else if (camCounter === 7 && bonnie === 4) camImg.src = 'nightshift/bonnie/supplyCloset.png';
                    else if (camCounter === 8 && bonnie === 5) camImg.src = 'nightshift/bonnie/westCorner.png';
                    const chica = this.state.animatronics.chica.pos;
                    if (camCounter === 0) {
                        if (bonnie >= 1 && chica >= 1) camImg.src = 'nightshift/chica/showStageA.png';
                        else if (bonnie <= 0 && chica >= 1) camImg.src = 'nightshift/chica/showStageB.png';
                    }
                    else if (camCounter === 1 && chica === 1) camImg.src = 'nightshift/chica/diningArea.png';
                    else if (camCounter === 4 && chica === 2) camImg.src = 'nightshift/chica/restrooms.png';
                    else if (camCounter === 5 && chica === 3) camImg.src = 'nightshift/chica/kitchen.png';
                    else if (camCounter === 9 && chica === 4) camImg.src = 'nightshift/chica/eastHall.png';
                    else if (camCounter === 10 && chica === 5) camImg.src = 'nightshift/chica/eastCorner.png';
                    const freddy = this.state.animatronics.freddy.pos;
                    if (camCounter === 0 && freddy >= 1) camImg.src = 'nightshift/freddy/showStage.png';
                    else if (camCounter === 1 && freddy === 1) camImg.src = 'nightshift/freddy/diningArea.png';
                    else if (camCounter === 4 && freddy === 2) camImg.src = 'nightshift/freddy/restrooms.png';
                    else if (camCounter === 5 && freddy === 3) camImg.src = 'nightshift/freddy/kitchen.png';
                    else if (camCounter === 9 && freddy === 4) camImg.src = 'nightshift/freddy/eastHall.png';
                    else if (camCounter === 10 && freddy === 5) camImg.src = 'nightshift/freddy/eastCorner.png';
                    const foxy = this.state.animatronics.foxy.pos;
                    if (camCounter === 3) {
                        if (foxy === 1) camImg.src = 'nightshift/foxy/pirateCove1.png';
                        else if (foxy === 2) camImg.src = 'nightshift/foxy/pirateCove2.png';
                        else if (foxy >= 3) camImg.src = 'nightshift/foxy/pirateCove3.png';
                    }
                    else if (camCounter === 6 && foxy === 3) camImg.src = 'nightshift/foxy/westHall.gif';
                    if (camCounter === 8 && this.state.golden.active) {
                        camImg.src = 'nightshift/goldenFreddy/westCorner.png';
                    }
                },

                staticEffect() {
                    const st = this.getElement('static');
                    if (!st) return;
                    st.style.opacity = 1;
                    TimerManager.add(() => { 
                        if (st) st.style.opacity = 0.3; 
                    }, 500);
                },

                timer() {
                    if (this.state.isGameOver) return;
                    const timerTxt = this.getElement('timerTxt');
                    if (!timerTxt) return;
                    timerTxt.innerText = this.state.timerCounter + 
                        (this.state.timerCounter === 12 ? ':00 AM' : ' AM');
                    this.state.timerCounter++;
                    if (this.state.timerCounter > 12) this.state.timerCounter = 1;
                    if (this.state.timerCounter === 7) {
                        window.location.href = 'survived.html';
                        return;
                    }
                    const delay = (this.state.timerCounter === 1 || this.state.timerCounter === 12) ? 30000 : 29000;
                    TimerManager.add(() => this.timer(), delay);
                },

                power() {
                    if (this.state.isGameOver) return;
                    const powerTxt = this.getElement('powerTxt');
                    if (!powerTxt) return;
                    powerTxt.innerText = 'POWER LEFT: ' + this.state.powerCounter + '%';
                    if (this.state.powerCounter <= 0) {
                        this.state.powerCounter = 0;
                        this.powerDown();
                        return;
                    }
                    this.state.powerCounter--;
                    let drainSpeed = 4000;
                    if (this.state.usageCounter === 2) drainSpeed = 3000;
                    else if (this.state.usageCounter === 3) drainSpeed = 2000;
                    else if (this.state.usageCounter >= 4) drainSpeed = 1000;
                    TimerManager.add(() => this.power(), drainSpeed);
                },

                powerDown() {
                    if (this.state.bearOutage === 0) {
                        this.state.bearOutage = 1;
                        this.state.isGameOver = true;
                        if (this.state.tablet) this.handleMonitorClick();
                        this.gameOverCleanUp();
                        this.setVisible('timerTxt', false);
                        this.setVisible('powerTxt', false);
                        this.setVisible('usageTxt', false);
                        this.getElement('office').src = 'nightshift/powerDown/office.gif';
                        AudioManager.play('powerDown');
                        TimerManager.add(() => AudioManager.play('musicBox'), 2000);
                        TimerManager.add(() => {
                            this.gameOverCleanUp();
                            this.getElement('office').src = 'nightshift/powerDown/jumpscare.gif';
                            AudioManager.play('jumpscare');
                            TimerManager.add(() => { window.location.href = 'game over.html' }, 1900);
                        }, 21000);
                    }
                },

                bonnie() {
                    if (this.state.isGameOver || this.state.animatronics.bonnie.isMoving) return;
                    this.state.animatronics.bonnie.isMoving = true;
                    let pos = this.state.animatronics.bonnie.pos;
                    if (pos === -1) pos = 0;
                    else if (pos === 0) pos = 1;
                    else if (pos === 1) pos = Math.floor(Math.random() * 2) + 2;
                    else if (pos === 2) pos = 1;
                    else if (pos === 3) pos = Math.floor(Math.random() * 2) + 4;
                    else if (pos === 4) pos = 3;
                    else if (pos === 5) pos = 6;
                    this.state.animatronics.bonnie.pos = pos;
                    if (pos === 6) {
                        if (this.state.leftDoor) {
                            this.state.animatronics.bonnie.pos = this.state.animatronics.freddy.pos <= 0 ? -1 : 0;
                            this.state.animatronics.bonnie.isMoving = false;
                            TimerManager.add(() => this.bonnie(), 5000);
                            return;
                        } else {
                            this.state.animatronics.bonnie.pos = 7;
                            this.state.animatronics.bonnie.isMoving = false;
                            TimerManager.add(() => this.bonnie(), 5000);
                            return;
                        }
                    }
                    if (pos === 7) {
                        if (this.state.leftDoor) {
                            this.state.animatronics.bonnie.pos = this.state.animatronics.freddy.pos <= 0 ? -1 : 0;
                            this.state.animatronics.bonnie.isMoving = false;
                            TimerManager.add(() => this.bonnie(), 5000);
                            return;
                        } else {
                            this.triggerJumpscare('bonnie');
                            return;
                        }
                    }
                    const walkSounds = ['walk1', 'walk2', 'walk3', 'walk4', 'walk5', 'walk1'];
                    if (pos < 6) AudioManager.play(walkSounds[pos]);
                    if (pos < 6) {
                        if (this.state.tablet) {
                            this.staticEffect();
                            const cameras = [0, 1, 2, 6, 7, 8];
                            if (cameras.includes(this.state.currentCam)) {
                                this.camera(this.state.currentCam, true);
                            }
                        }
                        this.state.animatronics.bonnie.isMoving = false;
                        TimerManager.add(() => this.bonnie(), 5000);
                    }
                },

                chica() {
                    if (this.state.isGameOver || this.state.animatronics.chica.isMoving) return;
                    this.state.animatronics.chica.isMoving = true;
                    let pos = this.state.animatronics.chica.pos;
                    if (pos === -1) pos = 0;
                    else if (pos === 0) pos = 1;
                    else if (pos === 1) pos = Math.floor(Math.random() * 3) + 2;
                    else if (pos === 2) pos = 1;
                    else if (pos === 3) pos = 1;
                    else if (pos === 4) pos = 5;
                    else if (pos === 5) pos = 6;
                    this.state.animatronics.chica.pos = pos;
                    if (pos === 6) {
                        if (this.state.rightDoor) {
                            this.state.animatronics.chica.pos = this.state.animatronics.freddy.pos <= 0 ? -1 : 0;
                            this.state.animatronics.chica.isMoving = false;
                            TimerManager.add(() => this.chica(), 10000);
                            return;
                        } else {
                            this.state.animatronics.chica.pos = 7;
                            this.state.animatronics.chica.isMoving = false;
                            TimerManager.add(() => this.chica(), 5000);
                            return;
                        }
                    }
                    if (pos === 7) {
                        if (this.state.rightDoor) {
                            this.state.animatronics.chica.pos = this.state.animatronics.freddy.pos <= 0 ? -1 : 0;
                            this.state.animatronics.chica.isMoving = false;
                            TimerManager.add(() => this.chica(), 10000);
                            return;
                        } else {
                            this.triggerJumpscare('chica');
                            return;
                        }
                    }
                    if (pos < 6) {
                        if (this.state.tablet) {
                            this.staticEffect();
                            const cameras = [0, 1, 4, 5, 9, 10];
                            if (cameras.includes(this.state.currentCam)) {
                                this.camera(this.state.currentCam, true);
                            }
                        }
                        this.state.animatronics.chica.isMoving = false;
                        TimerManager.add(() => this.chica(), 6000);
                    }
                },

                freddy() {
                    if (this.state.isGameOver || this.state.animatronics.freddy.isMoving) return;
                    this.state.animatronics.freddy.isMoving = true;
                    let pos = this.state.animatronics.freddy.pos;
                    if (pos === -1) pos = 0;
                    else if (pos === 0) pos = 1;
                    else if (pos === 1) pos = Math.floor(Math.random() * 3) + 2;
                    else if (pos === 2) pos = 1;
                    else if (pos === 3) pos = 1;
                    else if (pos === 4) pos = 5;
                    else if (pos === 5) pos = 6;
                    this.state.animatronics.freddy.pos = pos;
                    if (pos === 6) {
                        if (this.state.rightDoor) {
                            this.state.animatronics.freddy.pos = 5;
                            this.state.animatronics.freddy.isMoving = false;
                            TimerManager.add(() => this.freddy(), 15000);
                            return;
                        } else {
                            this.state.animatronics.freddy.pos = 7;
                            this.state.animatronics.freddy.isMoving = false;
                            TimerManager.add(() => this.freddy(), 5000);
                            return;
                        }
                    }
                    if (pos === 7) {
                        if (this.state.rightDoor) {
                            this.state.animatronics.freddy.pos = 5;
                            this.state.animatronics.freddy.isMoving = false;
                            TimerManager.add(() => this.freddy(), 15000);
                            return;
                        } else {
                            this.triggerJumpscare('freddy');
                            return;
                        }
                    }
                    if (pos < 6) {
                        if (this.state.tablet) {
                            this.staticEffect();
                            const cameras = [0, 1, 4, 5, 9, 10];
                            if (cameras.includes(this.state.currentCam)) {
                                this.camera(this.state.currentCam, true);
                            }
                        }
                        this.state.animatronics.freddy.isMoving = false;
                        TimerManager.add(() => this.freddy(), 12000);
                    }
                },

                foxy() {
                    if (this.state.isGameOver || this.state.animatronics.foxy.isMoving) return;
                    this.state.animatronics.foxy.isMoving = true;
                    let pos = this.state.animatronics.foxy.pos;
                    if (pos === -1) pos = 1;
                    else if (pos === 1) pos = 2;
                    else if (pos === 2) pos = 3;
                    else if (pos === 3) pos = 4;
                    this.state.animatronics.foxy.pos = pos;
                    if (pos === 4) {
                        if (this.state.leftDoor) {
                            this.state.powerCounter = Math.max(0, this.state.powerCounter - 15);
                            this.state.animatronics.foxy.pos = 1;
                            this.state.animatronics.foxy.isMoving = false;
                            AudioManager.play('door');
                            TimerManager.add(() => this.foxy(), 10000);
                            return;
                        } else {
                            this.state.animatronics.foxy.pos = 5;
                            AudioManager.play('run');
                            this.state.animatronics.foxy.isMoving = false;
                            TimerManager.add(() => this.foxy(), 1500);
                            return;
                        }
                    }
                    if (pos === 5) {
                        if (this.state.leftDoor) {
                            this.state.powerCounter = Math.max(0, this.state.powerCounter - 15);
                            this.state.animatronics.foxy.pos = 1;
                            this.state.animatronics.foxy.isMoving = false;
                            AudioManager.play('door');
                            TimerManager.add(() => this.foxy(), 10000);
                            return;
                        } else {
                            this.triggerJumpscare('foxy');
                            return;
                        }
                    }
                    const laughs = ['laugh1', 'laugh2', 'laugh3'];
                    if (pos >= 1 && pos <= 3) AudioManager.play(laughs[pos - 1]);
                    if (pos < 4) {
                        if (this.state.tablet) {
                            this.staticEffect();
                            if ([3, 6].includes(this.state.currentCam)) {
                                this.camera(this.state.currentCam, true);
                            }
                        }
                        this.state.animatronics.foxy.isMoving = false;
                        TimerManager.add(() => this.foxy(), 15000);
                    }
                },

                goldenAI() {
                    if (this.state.isGameOver || this.state.tablet) return;
                    const chance = Math.random();
                    if (chance < 0.002) {
                        if (!this.state.golden.active) {
                            this.state.golden.active = true;
                            this.state.golden.scare = 1;
                            this.setVisible('goldenOffice', true);
                            AudioManager.play('goldenLaugh');
                        }
                    } else {
                        if (this.state.golden.scare === 1) {
                            this.setVisible('goldenOffice', false);
                            this.state.golden.scare = 0;
                        }
                    }
                    if (!this.state.isGameOver) {
                        TimerManager.add(() => this.goldenAI(), 1000);
                    }
                },

                goldenJumpscare() {
                    if (this.state.golden.scare === 1 && !this.state.tablet) {
                        this.triggerJumpscare('golden');
                    }
                },

                triggerJumpscare(animatronic) {
                    this.state.isGameOver = true;
                    this.gameOverCleanUp();
                    const jumpscares = {
                        bonnie: { img: 'nightshift/bonnie/jumpscare.gif', sound: 'jumpscare', delay: 1100 },
                        chica: { img: 'nightshift/chica/jumpscare.gif', sound: 'oui', delay: 1100 },
                        freddy: { img: 'nightshift/freddy/jumpscare.gif', sound: 'jumpscare', delay: 1200 },
                        foxy: { img: 'nightshift/foxy/jumpscare.gif', sound: 'jumpscare', delay: 1500, soundDelay: 800 },
                        golden: { img: 'nightshift/goldenFreddy/jumpscare.gif', sound: 'goldenJumpscare', delay: 2700 }
                    };
                    const js = jumpscares[animatronic];
                    this.getElement('office').src = js.img;
                    if (js.soundDelay) {
                        TimerManager.add(() => AudioManager.play(js.sound), js.soundDelay);
                    } else {
                        AudioManager.play(js.sound);
                    }
                    TimerManager.add(() => { window.location.href = 'game over.html' }, js.delay);
                },

                gameOverCleanUp() {
                    TimerManager.clearAll();
                    AudioManager.stopAll();
                    const uiElements = ['leftButtom', 'rightButtom', 'monitor', 'timerTxt', 
                                       'powerTxt', 'usageTxt', 'goldenOffice', 'camera', 
                                       'static', 'map', 'leftDoor', 'rightDoor'];
                    uiElements.forEach(id => this.setVisible(id, false));
                    const camButtons = ['showStage', 'diningArea', 'backstage', 'pirateCove', 
                                       'restrooms', 'kitchen', 'westHall', 'supplyCloset', 
                                       'westCorner', 'eastHall', 'eastCorner'];
                    camButtons.forEach(id => this.setVisible(id, false));
                    this.state.tablet = false;
                },

                async preloadAssets() {
                    const images = [
                        'nightshift/office-open.png', 'nightshift/office-closed.png',
                        'nightshift/office-left-door.png', 'nightshift/office-right-door.png'
                    ];
                    let loaded = 0;
                    const total = images.length;
                    for (const src of images) {
                        const img = new Image();
                        img.src = src;
                        await new Promise(resolve => {
                            img.onload = () => {
                                loaded++;
                                const percent = Math.floor((loaded / total) * 100);
                                const loadingEl = document.getElementById('loading');
                                if (loadingEl) loadingEl.innerText = `Carregando... ${percent}%`;
                                resolve();
                            };
                            img.onerror = () => resolve();
                        });
                    }
                },

                async start() {
                    await this.preloadAssets();
                    const loadingEl = document.getElementById('loading');
                    if (loadingEl) loadingEl.style.display = 'none';
                    const audio = this.getElement('audio');
                    if (audio) {
                        audio.volume = 0.5;
                        audio.play().catch(() => {
                            console.info('Clique para iniciar música');
                        });
                    }
                    this.updateUI();
                    this.timer();
                    this.power();
                    TimerManager.add(() => this.bonnie(), 2000);
                    TimerManager.add(() => this.chica(), 3000);
                    TimerManager.add(() => this.freddy(), 5000);
                    TimerManager.add(() => this.foxy(), 4000);
                    TimerManager.add(() => this.goldenAI(), 1000);
                }
            };

            window.addEventListener('error', (e) => {
                console.error('Erro crítico:', e);
            });

            window.onload = () => game.start();
        </script>
    </body>
</html>
