<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Game Over</title>

<style>
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: Arial, Helvetica, sans-serif;
        background: #000;
    }

    body {
        background-image: url("game over/backstage.png");
        background-repeat: no-repeat;
        background-size: cover;
        background-position: left center;
        color: #fff;
    }

    #countText {
        position: fixed;
        right: 160px;
        bottom: 0px;
        font-size: 70px;
        font-weight: 900;
        color: #bd0a0a;
        text-shadow: 0 0 12px #000;
        z-index: 3;
    }

    #unlockAudioBtn {
        display: none;
        position: fixed;
        left: 50%;
        bottom: 20%;
        transform: translateX(-50%);
        z-index: 5;
    }

    #unlockAudioBtn button {
        padding: 12px 18px;
        background: #ff4444;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 700;
    }

    @media (max-width: 900px) {
        #countText { font-size: 60px; right: 20px; bottom: 40px; }
    }
</style>
</head>

<body>

<div id="countText">20</div>

<audio id="gameOverMusic" src="nightshift/audios/gameover.mp3" preload="auto"></audio>
<audio id="boomSound" src="nightshift/audios/boom.mp3" preload="auto"></audio>

<div id="unlockAudioBtn">
    <button id="unlockBtn">Clique para ouvir a m√∫sica</button>
</div>

<script>
(function() {
    let remaining = 20;
    const countText = document.getElementById("countText");
    const audio = document.getElementById("gameOverMusic");
    const boom = document.getElementById("boomSound");

    function startCountdown(){
        countText.innerText = remaining;

        const tick = setInterval(() => {
            remaining--;

            if (remaining <= 5 && remaining > 0) {
                countText.style.opacity = (remaining % 2 === 0 ? "1" : "0.15");
            }

            if (remaining <= 0){
                clearInterval(tick);
                countText.style.opacity = "1";

                try { boom.currentTime = 0; boom.play(); } catch(e){}
                try { audio.pause(); } catch(e){}

                setTimeout(() => {
                    window.location.href = "index.html";
                }, 900);

                return;
            }

            countText.innerText = remaining;

        }, 1000);
    }

    function tryPlayAudio(){
        try {
            audio.currentTime = 0;
            const p = audio.play();

            if (p) {
                p.then(startCountdown)
                 .catch(() => {
                    startCountdown();
                    document.getElementById("unlockAudioBtn").style.display = "block";
                 });
            } else {
                startCountdown();
            }

        } catch(e) {
            startCountdown();
            document.getElementById("unlockAudioBtn").style.display = "block";
        }
    }

    function unlockOnce(){
        try {
            audio.muted = true;
            const p = audio.play();

            if (p) {
                p.then(() => {
                    audio.pause();
                    audio.currentTime = 0;
                    audio.muted = false;
                    window.removeEventListener("click", unlockOnce);
                }).catch(() => {
                    window.removeEventListener("click", unlockOnce);
                });
            }
        } catch(e) {
            window.removeEventListener("click", unlockOnce);
        }
    }

    document.getElementById("unlockBtn").onclick = function(){
        try {
            audio.currentTime = 0;
            const p = audio.play();

            if (p) p.then(() => document.getElementById("unlockAudioBtn").style.display = "none");
            else document.getElementById("unlockAudioBtn").style.display = "none";

        } catch(e){
            document.getElementById("unlockAudioBtn").style.display = "none";
        }
    };

    tryPlayAudio();
    window.addEventListener("click", unlockOnce, { once: true });
})();
</script>

</body>
</html>
